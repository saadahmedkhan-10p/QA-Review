{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="fw-bold text-gradient" style="font-size:2.5rem;">
                <i class="bi bi-speedometer2 me-2"></i> Admin Dashboard
            </h1>
            <div class="d-flex gap-2">
                <a href="{{ url_for('send_reminders') }}" class="btn btn-warning shadow-sm rounded-pill px-4">
                    <i class="bi bi-envelope"></i> Send Review Reminders
                </a>
                <a href="{{ url_for('manage_projects') }}" class="btn btn-primary shadow-sm rounded-pill px-4">
                    <i class="bi bi-folder"></i> Manage Projects
                </a>
                <a href="{{ url_for('add_question') }}" class="btn btn-info shadow-sm rounded-pill px-4">
                    <i class="bi bi-question-circle"></i> Manage Questions
                </a>
                <a href="{{ url_for('manage_users') }}" class="btn btn-success shadow-sm rounded-pill px-4">
                    <i class="bi bi-people"></i> Manage Users
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4 g-4 justify-content-center d-flex flex-wrap flex-lg-nowrap align-items-stretch">
    <div class="col-12 col-lg-3 mb-3 mb-lg-0">
        <div class="card shadow-lg rounded-4 border-0 text-center bg-white h-100">
            <div class="card-body py-4">
                <div class="mb-2">
                    <i class="bi bi-table" style="font-size:2rem;color:#6c63ff;"></i>
                </div>
                <h5 class="fw-bold">All Submissions</h5>
                <h2 class="text-primary fw-bold">{{ submissions|length }}</h2>
            </div>
        </div>
    </div>
    <div class="col-12 col-lg-3 mb-3 mb-lg-0">
        <div class="card shadow-lg rounded-4 border-0 text-center bg-white h-100">
            <div class="card-body py-4">
                <div class="mb-2">
                    <i class="bi bi-folder2-open" style="font-size:2rem;color:#6c63ff;"></i>
                </div>
                <h5 class="fw-bold">Projects</h5>
                <h2 class="text-primary fw-bold">{{ projects|length }}</h2>
            </div>
        </div>
    </div>
    <div class="col-12 col-lg-3 mb-3 mb-lg-0">
        <div class="card shadow-lg rounded-4 border-0 text-center bg-white h-100">
            <div class="card-body py-4">
                <div class="mb-2">
                    <i class="bi bi-person-badge" style="font-size:2rem;color:#6c63ff;"></i>
                </div>
                <h5 class="fw-bold">Users</h5>
                <h2 class="text-primary fw-bold">{{ users|length }}</h2>
            </div>
        </div>
    </div>
    <div class="col-12 col-lg-3 mb-3 mb-lg-0">
        <div class="card shadow-lg rounded-4 border-0 text-center bg-white h-100">
            <div class="card-body py-4">
                <div class="mb-2">
                    <i class="bi bi-question-circle" style="font-size:2rem;color:#6c63ff;"></i>
                </div>
                <h5 class="fw-bold">Questions</h5>
                <h2 class="text-primary fw-bold">{{ questions|length }}</h2>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card shadow-lg rounded-4 border-0">
            <div class="card-body">
                <h4 class="fw-bold mb-3"><i class="bi bi-table"></i> All Submissions (Flat View)</h4>
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light sticky-top">
                            <tr>
                                <th>ID</th>
                                <th>Project</th>
                                <th>Review Leads</th>
                                <th>User</th>
                                <th>Month</th>
                                <th>Status</th>
                                <th>Scheduled Date</th>
                                <th>Submitted Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for submission in submissions %}
                            <tr>
                                <td>{{ submission.id }}</td>
                                <td>{{ submission.project.name if submission.project else '-' }}</td>
                                <td>
                                    {% if submission.project and submission.project.review_leads %}
                                        {% for lead in submission.project.review_leads %}
                                            <span class="badge bg-info text-dark me-1">{{ lead.name }}</span>
                                        {% endfor %}
                                    {% else %}-{% endif %}
                                </td>
                                <td>{{ submission.user.name if submission.user else '-' }}</td>
                                <td>{{ submission.month }}</td>
                                <td>
                                    {% if submission.status == 'scheduled' %}
                                        <span class="badge bg-warning">Scheduled</span>
                                    {% elif submission.status == 'submitted' %}
                                        <span class="badge bg-success">Submitted</span>
                                    {% else %}
                                        <span class="badge bg-secondary">{{ submission.status }}</span>
                                    {% endif %}
                                </td>
                                <td>{{ submission.scheduled_date.strftime('%Y-%m-%d %H:%M') if submission.scheduled_date else '-' }}</td>
                                <td>{{ submission.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                <td>
                                    <a href="{{ url_for('view_submission', id=submission.id) }}" class="btn btn-sm btn-primary rounded-pill me-2">
                                        <i class="bi bi-eye"></i> View
                                    </a>
                                    <form method="POST" action="{{ url_for('send_individual_reminder', submission_id=submission.id) }}" style="display:inline;">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                                        <button type="submit" class="btn btn-sm btn-warning rounded-pill">
                                            <i class="bi bi-envelope"></i> Send Reminder
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
